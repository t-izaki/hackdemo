# これはなに？
- 「脆弱性って何ですか？」という人を対象にした、簡単な脆弱性体験Webサービス（社員管理システム）を作りました
- SQLインジェクション, パラメーターの検証不備, XSSなどの脆弱性を体験できます

<img src="https://raw.githubusercontent.com/tenkiame/hackdemo/9aabd7adfe69039d1c00abf090ddb0ed348b195c/screenshots/index.png" width="600px">

# はじめに

### 利用用途
- Webサービスや脆弱性にあまり馴染みがない人に、脆弱性を実感してもらうために
- ビギナーWebエンジニアが脆弱性の仕組みを理解するために

### 環境
- PHP(7.2)
- MySQL
- Apache

### 使い方
1. ソースコードを適当なLAMP環境に展開してください
2. `assets/models/AppModel.php`に記載のあるMySQLの情報をカスタマイズし、MySQLと接続してください
3. `etc/seed_data.sql`を、MySQLに流し込んでください

### 類似サービスについて
以下のような類似サービスがあります。以前確認したときは、Windows10に対応していなかったこともあり、今回の自作に至ったのですが、今確認すると普通に対応していましたね...

- 脆弱性体験学習ツール AppGoat (IPA) https://www.ipa.go.jp/security/vuln/appgoat/


# 脆弱性を攻撃してみよう

以下の脆弱性を意図的に埋め込んでいます。実際に攻撃して確かめてみてください。解答例は後半に掲載しています。

## 1.SQLインジェクション

### 1-1.このサービスのログインフォームには、SQLインジェクションの脆弱性が存在しています。この脆弱性を利用して、他社のアカウントに不正ログインを行い、他社の従業員情報を盗み見てください。

#### あらかじめ与えられる情報
- ログインフォームにアクセスするためのURL（`login.php`）
- 登録されているユーザー名のリスト(`user001`, `user002`, `user003`, `user004`)

### 1-2.このサービスの検索フォームには、SQLインジェクションの脆弱性が存在しています。この脆弱性を利用して、システムに登録されている全ての会社の従業員情報をブラウザ上に表示させてください。

#### あらかじめ与えられる情報
- ログインフォームにアクセスするためのURL（`login.php`）
- ログイン可能なユーザー名とパスワードの組


## 2.パラメータの検証不備

### 2-1.このサービスにはパラメータの検証不備の脆弱性が存在しています。この脆弱性を利用して、少なくとも1人の他社の社員の詳細情報をブラウザ上に表示してください。

#### あらかじめ与えられる情報
- ログインフォームにアクセスするためのURL（`login.php`）
- ログイン可能なユーザー名とパスワードの組

### 2-2.このサービスにはパラメータの検証不備の脆弱性が存在しています。この脆弱性を利用して、自社の社員ではなく、他社の社員を勝手に登録してください。

#### あらかじめ与えられる情報
- ログインフォームにアクセスするためのURL（`login.php`）
- ログイン可能なユーザー名とパスワードの組
- 利用している会社名のリスト（`制服のマネキン株式会社`, `君の名は希望株式会社`, `バレッタ株式会社`, `太陽ノック株式会社`）


## 3.XSS（Cross Site Scripting）

### 3-1.このサービスの社員登録フォームには、XSSの脆弱性が存在しています。この脆弱性を利用して、他社の社員一覧画面に不正なプログラムを埋め込み、好きなWebページにリダイレクトさせてください。

#### あらかじめ与えられる情報
- ログインフォームにアクセスするためのURL（`login.php`）
- ログイン可能なユーザー名とパスワードの組


# 解答の例

## 1-1.について

1. ユーザー名に`user001' --　 `と入力します(`--`の後ろには半角スペースが必要です)
2. パスワードは空欄とします
3. 「ログイン」ボタンを押下します

### 簡単な解説

以下のようなSQL文が発行されます。`--　`は、SQL文においてコメントを意味します

```SQL
SELECT * FROM admin WHERE name = 'user001' --　 ' AND encrypted_password = '$2y$07$q2TkOUHq5HpCXxU2eXN88eiYfsqIklCclJF1HMI6mngtPq5FWU/Ci'
```

## 1-2.について

1. 検索フィールドに`' OR 1=1 -- `と入力します(`--`の後ろには半角スペースが必要です)
2. 「検索」ボタンを押下します

### 簡単な解説

以下のようなSQL文が発行されます。

```SQL
SELECT * FROM user WHERE company = '制服のマネキン株式会社' AND name LIKE '%' OR 1=1 -- %'
```

## 2-1.について

1. 適当な社員の詳細画面にアクセスします
2. URLの末尾`userid=xx`の`xx`の部分を、好きな数字に書き換えます

## 2-2.について

1. 社員の新規登録画面にアクセスし、名前を適当に入力します
2. ブラウザの検証を開き、ソースの`<input type="hidden" name="company" value="XXX株式会社">`に記載されている会社名を、別の会社名に書き換えます
3. 「作成する」ボタンを押下します

## 3-1.について

1. 社員の新規登録画面にアクセスし、上記2-2 2.の操作を行います
2. 名前として`<script>window.location.href="https://www.yahoo.co.jp/";</script>`を入力します(URLは好きなサイトに変更する)
3. 「作成する」ボタンを押下します

# 最後に

上記の行為を一般のWebサービスで実施すると、不正アクセス禁止法に該当する可能性があるため、十分に注意してください。
以下、不正アクセス禁止法の条文の抜粋です。

> 第二条 4 この法律において「不正アクセス行為」とは、次の各号のいずれかに該当する行為をいう。
> (中略)
> 二 アクセス制御機能を有する特定電子計算機に電気通信回線を通じて当該アクセス制御機能による特定利用の制限を免れることができる情報（識別符号であるものを除く。）又は指令を入力して当該特定電子計算機を作動させ、その制限されている特定利用をし得る状態にさせる行為
> (中略)
> 第三条　何人も、不正アクセス行為をしてはならない。
